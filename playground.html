<!DOCTYPE html>
<html>
<!--[if gt IE 6]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 crappy" lang="en"><head><title>WTF!</title></head><body><h1>put down the crack pipe and use chrome!</h1></body></html> <![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>HTML5 Playground</title>
<style type="text/css">
header, footer, aside,section, article, nav, div, iframe {
	display:block;
	margin:0;
	padding: 0;
}
html{
	background: #ededed;
	font-family: arial;
	color: #393939;
	font-size: 1em;
	line-height: 1;
}
body{
	height: 100%;
	width: 100%;
}
header#playground{
	height: 4em;
	width: 100%;
	border-bottom: .0625em;
	text-shadow: 3px 3px 5px #999, -3px 3px 5px #999;
}
section#editrange{
	width: 28%;
	border-right: 1px solid #393939;
	float:left;
	height: 40em;
	overflow:hidden;
	outline: 1px solid black;
	box-shadow: 3px 3px 5px #999;
}
	section#editrange nav{
		height: 1em;
		width:  100%;
		border-bottom: .0625em solid #f8d93f;
		clear:both;
		padding: 1em 0;
		background: #fef9eb;
	}
		section#editrange nav ul{
			margin: 0;
			padding: 0;
			width: 55%;
			float:left;
			height: 100%;
		}
			section#editrange nav li{
				list-style-type: none;
				float:left;
				margin: 0 .75em;
			}
			section#editrange nav a{
				display:block;
				color: #999;
				text-decoration: none;
			}
	div[contenteditable]{
		font-family: courier, monospace;
		height: 33em;
		width: 100%;
		color: #3f67f8;
		background: #fff;
		float:left;
		outline: 1px solid blue;
	}
	div[contenteditable]:not(:target){ /* this is cheaper than crazy fixed positioning and floating*/
		display:none;
	}
	div[contenteditable]:target{
		display:block;
	}
section#editrange footer{
	clear:both;
	border-top: .0625em;
	background: #fef9eb;
	width: inherit;
	height: 3em;
	border-top: .0625em solid #f8d93f;
	position:fixed;
	bottom: 0;
}
iframe{
	width: 70%;
	float:right;
	height: 35em;
	box-shadow: -3px 3px 5px #999
}
input, button, select, option{
	padding: .35em;
	outline:none;
	border: 1px solid #3f67f8;
	border-radius: .25em;
	font-size: .8em;
}
button, select{
	background: #3f67f8;
	color: #fff;
}
input{
	background: #fff;
	color:#3f67f8 ;
}
:target {
	color: #444;
	background: #999;
}
</style>
<script type="text/javascript" src="jquery-1.7.min.js"></script>
</head>
<body>
<header id="playground">
<h1>HTML5 playground</h1>
</header>
<section id="editrange">
	<nav>
		<ul>
			<li><a href="#content">HTML</a></li>
			<li><a href="#css">CSS</a></li>
			<li><a href="#js">JS</a></li>
		</ul>
		<select id="saveditems"></select>
	</nav>
	<div id="content" contenteditable="true">
		HTML
	</div>
	<div id="css" contenteditable="true">
		css
	</div>
	<div id="js" contenteditable="true">
		js
	</div>
	<footer>
		<input type="text" name="filename" id="name" placeholder="name">
		<button id="save" onclick="save()">Save</button>
		<button id="clearthis" onclick="clearThis()">Delete</button>
		<button id="clear" onclick="clearStorage()">Clear All</button>
<script type="text/javascript">
	function clearStorage(){
		var answer = confirm ("Are you sure you want to delete all your work")
		if (answer){
			localStorage.clear();
			$('#saveditems').empty();
			alert ("Local storage has been cleared");
			$('#name').val().empty();
		} else{
			alert("local storage untouched");
			};
	};
	function clearThis(){
		var key = $('#name').val();
		var keyID = "#"+key;
			localStorage.removeItem(key);
			$(keyID).remove();
			$('#name').val("");
			//TODO: clear the content in the center
	};
	function save(){
		var key = $('#name').val();
		var markup = $('#content').text();
		var jscript = '<script type=\"text\/javascript\">' + $('#js').text() + "<\/script>";
		var styles = '<style type="text/css">' + $('#css').text() + "</style>";
		var content = styles + markup + jscript; //but it'd be cooler to turn CSS and JS into blobs, too
			if (!localStorage.getItem(key)){
				$('#saveditems').append('<option id=">'+ key + '">' + key +'</option>');
			}
			localStorage.setItem(key, JSON.stringify(markup)); //todo, put this in an indexedDB
			localStorage.setItem(key+"-CSS", JSON.stringify(styles));
			localStorage.setItem(key+"-JS", JSON.stringify(jscript));
			$('#save').css('background','#3f67f8');	
			$("#save").html('Saved!');
		var bb = new window.WebKitBlobBuilder();
		var iframe = $('#result');
			bb.append(content);
			$(iframe).prop("src", window.webkitURL.createObjectURL(bb.getBlob('text/html')) ) ;
	};
	function load(){
		var savedItems = $('#saveditems').val();
		var savedContent = JSON.parse(localStorage.getItem(savedItems));
		var savedCSS = JSON.parse(localStorage.getItem(savedItems+'-CSS'));
		var savedJS = JSON.parse(localStorage.getItem(savedItems+'-JS'));
		var bb = new window.WebKitBlobBuilder();
		var iframe = $('#result');
			$('#content').text(savedContent);
			$('#css').text(savedCSS);
			$('#js').text(savedJS);
			$('#name').val(savedItems);
			bb.append(savedContent);
			$(iframe).prop("src", window.webkitURL.createObjectURL(bb.getBlob('text/html')) ) ;
};
$('#saveditems').change(function(event){
	load();
});
	var numberItems = localStorage.length;
		for (i = 0; i <= numberItems - 1 ; i++)
			{//TODO: figure out how to NOT load the CSS and JS from localstorage here
			$('#saveditems').append('<option id="'+localStorage.key(i) + '"> ' + localStorage.key(i) + '</option>');
			};
		$('#content').keyup(function(event){
		$('#save').css('background', '#f83f42', 'border-color',"#f83f42").html('Save');
});
	</script>
	</footer>
</section>
<iframe id="result"></iframe>
</body>
</html>

