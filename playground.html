<!DOCTYPE html>
<html>
<!--[if gt IE 6]> <html class="no-js lt-ie9 lt-ie8 lt-ie7 crappy" lang="en"><head><title>WTF!</title></head><body><h1>put down the crack pipe and use chrome!</h1></body></html> <![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>HTML5 Playground</title>
<style type="text/css">
header,footer,aside,section,article,nav,div,iframe{display:block;margin:0;padding:0}html{font-family:arial;color:#393939;font-size:1em;line-height:1;background:#ededed}body{height:100%;width:100%}header#playground{height:4em;width:100%;border-bottom:.0625em;text-shadow:3px 3px 5px #999, -3px 3px 5px #999}section#editrange{width:28%;border-right:1px solid #393939;float:left;height:40em;overflow:hidden;outline:1px solid #000;box-shadow:3px 3px 5px #999}section#editrange nav{height:1em;width:100%;border-bottom:.0625em solid #f8d93f;clear:both;padding:1em 0;background:#fef9eb}section#editrange nav ul{width:55%;float:left;height:100%;margin:0;padding:0}section#editrange nav li{list-style-type:none;float:left;margin:0 .75em}section#editrange nav a{display:block;color:#999;text-decoration:none}section#editrange #saveditems{width:40%}div[contenteditable]{font-family:courier, monospace;height:33em;width:100%;color:#3f67f8;float:left;outline:1px solid blue;background:#fff}div[contenteditable]:not(:target){display:none}div[contenteditable]:target{display:block}section#editrange footer{clear:both;width:inherit;height:3em;border-top:.0625em solid #f8d93f;position:fixed;bottom:0;background:#fef9eb}iframe{width:70%;float:right;height:35em;box-shadow:-3px 3px 5px #999}input,button,select,option{outline:none;border:1px solid #3f67f8;border-radius:.25em;font-size:.8em;padding:.35em}button,select{color:#fff;background:#3f67f8}input{color:#3f67f8;background:#fff}:target{color:#444;background:#999}
</style>
<script type="text/javascript" src="jquery-1.7.min.js"></script>
</head>
<body>
<header id="playground">
<h1>HTML5 playground</h1>
</header>
<section id="editrange">
	<nav>
		<ul>
			<li><a href="#content">HTML</a></li>
			<li><a href="#css">CSS</a></li>
			<li><a href="#js">JS</a></li>
		</ul>
		<select id="saveditems"></select>
	</nav>
	<div id="content" contenteditable="true">
		HTML
	</div>
	<div id="css" contenteditable="true">
		css
	</div>
	<div id="js" contenteditable="true">
		js
	</div>
	<footer>
		<input type="text" name="filename" id="name" placeholder="name">
		<button id="save" onclick="save()">Save</button>
		<button id="clearthis" onclick="clearThis()">Delete</button>
		<button id="clear" onclick="clearStorage()">Clear All</button>
<script type="text/javascript">
	function clearStorage(){
		var answer = confirm ("Are you sure you want to delete all your work")
		if (answer){
			localStorage.clear();
			$('#saveditems').empty();
			alert ("Local storage has been cleared");
			$('#name').val().empty();
		} else{
			alert("local storage untouched");
			};
	};
	function clearThis(){
		var key = $('#name').val();
		var keyID = "#"+key;
			localStorage.removeItem(key);
			$(keyID).remove();
			$('#name').val("");
			//TODO: clear the content in the center
	};
	function save(){
		var key = $('#name').val();
		var markup = $('#content').text();
		var styles = $('#css').text() ;
		var jscript =  $('#js').text();
		var content = new Array(markup, styles, jscript); //take the whole bundle, turn it to an array
		//create the result
		var result = '<head><style type=\"text\/css\"> ' + content[1] + "<\/style><\/head><body>" + content[0] + "<script type=\"text\/css\">" + content[2] +"<\/script>";
		content = JSON.stringify(content); //now stringify our array
			if (!localStorage.getItem(key)){
				$('#saveditems').append('<option id=">'+ key + '">' + key +'</option>');
			}
			localStorage.setItem(key, content); //todo, put this in an indexedDB...nahhhh. stringify an array. 
			$('#save').css('background','#3f67f8');	
			$("#save").html('Saved!');
			//instantiate the blob
		var bb = new window.WebKitBlobBuilder();			
			bb.append(result);
			$('#result').prop("src", window.webkitURL.createObjectURL(bb.getBlob('text/html')) ) ;
	};
	function load(){
		var savedItems = $('#saveditems').val();
		var savedContent = JSON.parse(localStorage.getItem(savedItems)); //parse the stored item
		//create the result for the load event
		var loadResult = '<head><style type=\"text\/css\"> ' + savedContent[1] + "<\/style><\/head><body>" + savedContent[0] + '<script type=\"text\/javascript\"> ' + savedContent[2] + '<\/script><\/body><\/html>';
		var bb = new window.WebKitBlobBuilder();
			$('#content').text(savedContent[0]);
			$('#css').text(savedContent[1]);
			$('#js').text(savedContent[2]);
			$('#name').val(savedItems);
			bb.append(loadResult);
			$('#result').prop("src", window.webkitURL.createObjectURL(bb.getBlob('text/html')) ) ;
};
$('#saveditems').blur(function(event){
	load();
});
	var numberItems = localStorage.length;
		for (i = 0; i <= numberItems - 1 ; i++)
			{//TODO: figure out how to NOT load the CSS and JS from localstorage here
			$('#saveditems').append('<option id="'+localStorage.key(i) + '"> ' + localStorage.key(i) + '</option>');
			};
		$('#content').keyup(function(event){
		$('#save').css('background', '#f83f42', 'border-color',"#f83f42").html('Save');
});
	</script>
	</footer>
</section>
<iframe id="result"></iframe>
</body>
</html>

