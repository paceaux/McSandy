<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>McSandy: The HTML5 Playground<</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style type="text/css">
body,div,fieldset,form,h1,h2,h3,h4,h5,h6,html,input{padding:0;margin:0}body,html{height:100%;width:100%}body{display:flex;flex-direction:column;justify-content:space-around;align-items:flex-start;height:100%;width:100%}.h1,h1{font-size:1.2em}.h2,h1{font-size:1.1em}a,form,input,textarea{-webkit-transition:all .3s ease-in-out;-moz-transition:all .3s ease-in-out;-o-transition:all .3s ease-in-out;transition:all .3s ease-in-out}a:active,a:focus,a:hover,input:focus,input:hover,textarea:focus,textarea:hover{outline:0;-webkit-transition:all .3s ease-out;-moz-transition:all .3s ease-out;-o-transition:all .3s ease-out;transition:all .3s ease-out}button,input,select,textarea{border:1px solid hsla(128,38.2%,61.8%,1);outline:0}button:focus,button:hover,input:focus,input:hover,select:focus,select:hover,textarea:focus,textarea:hover{border:1px solid hsla(128,38.2%,38.2%,1)}button,input,select{padding:.618em;margin:.618em}button{background:hsla(128,38.2%,61.8%,1)}button:focus,button:hover{background:1px solid hsla(128,38.2%,38.2%,1)}.mpGlobal__header{-webkit-transition:all .3s ease-in-out;-moz-transition:all .3s ease-in-out;-o-transition:all .3s ease-in-out;transition:all .3s ease-in-out}.mpGlobal__footer,.mpGlobal__header{display:flex;flex-shrink:1;flex-direction:column;justify-content:flex-start;align-items:stretch;padding:.618em;width:100%;background:#f0f8ff}.mpGlobal__header__hgroup{display:flex;flex-direction:row;align-self:flex-start;align-items:baseline;justify-content:space-between;font-size:1em;width:100%}.mpGlobal__header__onlineStatus{align-self:flex-end;padding:.618em}.mpGlobal__header__controls__wrapper{display:flex;flex-direction:column;-webkit-transition:all .3s ease-in-out;-moz-transition:all .3s ease-in-out;-o-transition:all .3s ease-in-out;transition:all .3s ease-in-out}.wrapper__label{display:inline-block;align-self:flex-start;border:1px solid #e1e1e1;position:relative;top:-1em;margin:0;padding:.25em}.wrapper__toggle:checked~.mpGlobal__footer__controls,.wrapper__toggle:checked~.mpGlobal__footer__controls>.controls__fieldset,.wrapper__toggle:checked~.mpGlobal__header__controls,.wrapper__toggle:checked~.mpGlobal__header__controls>.controls__labelWrapper{height:0;overflow:hidden}.controls{display:flex;flex-direction:column;justify-content:space-between;flex-wrap:wrap;-webkit-transition:all .3s ease-in-out;-moz-transition:all .3s ease-in-out;-o-transition:all .3s ease-in-out;transition:all .3s ease-in-out}.mpGlobal__footer__controls{flex-direction:row}.controls__labelWrapper{display:inline-flex;flex-direction:row;justify-content:space-between}.controls__fieldset{display:flex;flex-direction:column;flex-grow:1}.controls__control{display:none}.controls__label{color:#ccc;display:block;font-size:.8em;padding:.618em;border:1px solid #ccc}.controls__editor{height:0;visibility:hidden;align-self:flex-end;flex-basis:0}.controls__editWrapper{display:flex}.control--html:checked~.controls__editWrapper .control--html{visibility:visible;height:20vh;flex-grow:1}.control--html:checked~.controls__labelWrapper .controls__label--html{color:#333;font-weight:700;border-color:#777}.control--css:checked~.controls__editWrapper .control--css{visibility:visible;height:20vh;flex-grow:1}.control--css:checked~.controls__labelWrapper .controls__label--css{color:#333;font-weight:700;border-color:#777}.control--js:checked~.controls__editWrapper .control--js{visibility:visible;height:20vh;flex-grow:1}.control--js:checked~.controls__labelWrapper .controls__label--js{color:#333;font-weight:700;border-color:#777}.mcsandy__result{display:flex;flex-direction:column;flex-grow:2;width:100%}.mcsandy__result__iframe{width:100%;outline:0;border:0}.online{color:green}.offline{color:red}</style>
</head>
    <body>
        <header class="mpGlobal__header">
            <div class="mpGlobal__header__hgroup">
                <h1 class="mpGlobal__header__h1 h1">McSandy</h1>
                <h2 class="mpGlobal__header__h2 h2">The offline HTML sandbox</h2>
                <span id="js-onlineStatus" class="mpGlobal__header__onlineStatus online">&#9673;</span>
            </div>
            <div class="mpGlobal__header__controls__wrapper wrapper">
                <label for="js-controls-toggle" class="wrapper__label">Toggle Panel</label>
                <input type="checkbox" id="js-controls-toggle" class="wrapper__toggle controls__control" />
            <form class="mpGlobal__header__controls controls">
                <input type="checkbox" id="js-htmlSwitch" class="controls__control controls__control--html control control--html" checked />
                <input type="checkbox" id="js-cssSwitch" class="controls__control controls__control--css control control--css" checked/>
                <input type="checkbox" id="js-jsSwitch" class="controls__control controls__control--js control control--js" checked/>
                <div class="controls__labelWrapper">
                    <label class="controls__label controls__label--html" for="js-htmlSwitch">HTML</label>
                    <label class="controls__label controls__label--css" for="js-cssSwitch">CSS</label>
                    <label class="controls__label controls__label--js" for="js-jsSwitch">JS</label>
                </div>
                <div class="controls__editWrapper">
                    <textarea  id="js-html" class="controls__editor controls__editor--html control control--html"  data-target="js-html-content" placeholder="<h1>"></textarea>
                    <textarea id="js-css" class="controls__editor controls__editor--css control control--css"  data-target="js-css-content" placeholder="h1{}"></textarea>
                    <textarea id="js-js" class="controls__editor controls__editor--js control control--js"  data-target="js-js-content" placeholder="var blah;"></textarea>
            </div>
            </form>
        </div>
        </header>
<main class="mcsandy__result">
    <iframe id="js-result" class="mcsandy__result__iframe"></iframe>
</main>
<footer class="mpGlobal__footer">
    <label for="js-footer-controls-toggle" class="wrapper__label">Toggle Panel</label>
    <input type="checkbox" id="js-footer-controls-toggle" class="wrapper__toggle controls__control" />
    <form class="mpGlobal__footer__controls controls">
        <fieldset class="controls__fieldset">
            <input id="js-projectName" class="controls__input controls__input--name" type="text" placeholder="Name of Project">
            <button id="js-projectSave" class="controls__button controls__button--save">Save</button>
            <button id="js-projectDel" class="controls__button controls__button--del">Delete</button>
        </fieldset>
        <fieldset class="controls__fieldset">
            <label for="js-selectProjects">Other Projects</label>
            <select id="js-selectProjects" >
                <option></option>
            </select>
        </fieldset>
    </form>
</footer>
<script type="text/javascript">
//store is the local/session storage helper. 
var store;
store = {
    types: [localStorage,sessionStorage],
    convertValue: function (v) {
        return typeof v !== "object" ? v : JSON.stringify(v);
    },
    unconvertValue: function (v) {
        if ( v.indexOf("{") === 0 || v.indexOf("[") === 0 ){
            var v = JSON.parse(v);
        }
        return v;
    },
    set: function (type, k, v) {
        var v = this.convertValue(v);
        store.types[type].setItem(k,v); 
    },
    get: function (type, k) {
        var v = typeof k !== "number" ? store.types[type].getItem(k) : store.types[type].key(k);
        return  this.unconvertValue(v);
    },
    del: function (type, k){
        store.types[type].removeItem(k);       
    },
    clr: function (type){
        store.types[type].clear();
    }
};

//McSandy UI is the editor and its controls. It's the content that goes in
var mcsandyUI;
mcsandyUI = {
    init: function () {
        var _this = mcsandyUI;
        _this.bindUiEvents();
    },
    data: {
        onlineState: 'online',
        onlineCtrl: document.getElementById('js-onlineStatus'),
        els: {
            projecSelect: document.getElementById('js-selectProjects')
        }
    },
    helpers: {
    },
    bindUiEvents: function () {
        var _this = mcsandyUI,
            els = _this.data.els;
        window.addEventListener('load', function (e) {
            _this.functions.handleConnection();
        });
        window.addEventListener("offline", _this.functions.handleConnection );
        window.addEventListener("online", _this.functions.handleConnection );
        els.projecSelect.addEventListener('change', _this.functions.handleProjectSelect);
    },
    functions: {
        handleConnection: function (e) {
            var _this = mcsandyUI,
                ctrl = document.getElementById('js-onlineStatus');
            _this.data.onlineState = navigator.onLine ? "online" : "offline";
            if (_this.data.onlineState == "online"){
                ctrl.className = ctrl.className.replace( /(?:^|\s)offline(?!\S)/g, " online");
            } else {
                ctrl.className = ctrl.className.replace( /(?:^|\s)online(?!\S)/g," offline");
            }
        },
        handleProjectSelect: function (e) {
            var _this = mcsandyUI,
                proj = e.target.value,
                projData = store.get(0,proj);
            mcsandy.functions.updateContent(projData); // this is in the McSandy interface
            _this.functions.updateEditors(projData.rawParts.html, projData.rawParts.css, projData.rawParts.js);
            _this.functions.updateProjectName(projData.project);
        },
        updateEditors: function (html, css, js) {
            var _this = mcsandyUI, 
                ctrls = mcsandy.data.ctrls;
            ctrls.html.value = html;
            ctrls.css.value = css;
            ctrls.js.value = js;
        },
        updateProjectName: function (projectName) {
            var _this = mcsandyUI,
                projectField = mcsandy.data.ctrls.project;
            projectField.value = projectName;
            projectField.placeholder = projectName;
        }
    }
}
mcsandyUI.init();

//mcsandy stores the data and retrieves the data. it also prepares the iframe
    var mcsandy;
    mcsandy = {
        init: function () {
            var _this = mcsandy;
            _this.bindUiEvents();
            _this.functions.getProjects();
        },
        data: {
            ctrls: {
                projectSave: document.getElementById('js-projectSave'),
                projectDel: document.getElementById('js-projectDel'),
                project: document.getElementById('js-projectName'),
                html: document.getElementById('js-html'),
                css: document.getElementById('js-css'),
                js: document.getElementById('js-js')
            },
            targets: {
                iframe: document.getElementById('js-result')
            }
        },
        blobData: {
            reset: 'html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{border:0;font-size:100%;font:inherit;vertical-align:baseline;margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:none}table{border-collapse:collapse;border-spacing:0}',
            jquery: '<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"><\/script>'
        },
        helpers: {
            updateContent: function (val, target) {
                target.innerHTML = val;
                return
            },
            prepareCSS: function (css) {
                return '<style type="text/css">' + css + '</style>'
            },
            prepareHTML: function (html) {
                return html
            },
            prepareJS: function (js) {
                return '<script type="text\/javascript">' + js + '<\/script>'
            },
            createRawParts:function (html, css, js) {
                var rawParts = {
                    html: html,
                    css: css,
                    js: js
                }
                return rawParts;
            },
            wrapProjectParts: function (html, css, js) {
                var _this = mcsandy,
                    helpers = _this.helpers,
                    blobData = _this.blobData,
                    ctrls = _this.data.ctrls,
                    html = helpers.prepareHTML(ctrls.html.value),
                    reset = helpers.prepareCSS(blobData.reset),
                    jquery = blobData.jquery,
                    css =  helpers.prepareCSS(ctrls.css.value),
                    head = '<head>'+css+'</head>',
                    js = helpers.prepareJS(ctrls.js.value),
                    blobKit = [head,html,jquery,js];
                return blobKit;
            },
            createProject: function (projectName, rawParts, blobArray) {
                return {
                    'project': projectName,
                    blobArray: blobArray,
                    rawParts: rawParts
                } 
            },
            prepareResult: function (parts) {
                var _this = mcsandy,
                    helpers = _this.helpers;
                if (window.URL) {
                    var blob = new Blob(parts, {type : 'text/html'});
                    return blob;                   
                }
            },
            getStoredProjects: function () {
                var _this = mcsandy,
                    len = localStorage.length,
                    projects = [];
                for (i = 0; i < len; i ++) {
                    var projectKey = store.get(0,i);
                    projects.push(projectKey);
                }
                return projects;
            },
            createSelectOption: function (el) {
                var _this = mcsandy,
                    option = document.createElement('option');
                option.value = el;
                option.text = el;
                return option;
            }
        },
        bindUiEvents: function () {
            var _this = mcsandy,
                functions = _this.functions,
                ctrls = _this.data.ctrls;
            ctrls.css.addEventListener('change',function (e) {
                functions.updateContent();
            });
            ctrls.html.addEventListener('change',function (e) {
                functions.updateContent();
            });
            ctrls.js.addEventListener('change',function (e) {
                functions.updateContent();
            });
            ctrls.projectSave.addEventListener('click', functions.saveContent);
            ctrls.projectDel.addEventListener('click', functions.delContent);
        },
        functions: {
            getProjects: function () {
                var _this = mcsandy,
                    projects = _this.helpers.getStoredProjects(),
                    select = document.getElementById('js-selectProjects');
                projects.forEach(function(el) {
                    var option = _this.helpers.createSelectOption(el);
                    select.appendChild(option);
                })
            },
            updateContent: function (loadedParts) {
                 var _this = mcsandy,
                    iframe = _this.data.targets.iframe,
                    parts =  loadedParts !== undefined ? loadedParts.blobArray : _this.helpers.wrapProjectParts();
                   var result = _this.helpers.prepareResult(parts);
                iframe.src = window.URL.createObjectURL(result);
            },
            delContent: function (e) {
                e.preventDefault();
                var _this = mcsandy,
                    projectName = _this.data.ctrls.project.value;
                store.del(0,projectName);
                _this.functions.getProjects();
            },
            saveContent: function (e) {
                e.preventDefault();
                var _this = mcsandy,
                    ctrls = _this.data.ctrls,
                    rawParts = _this.helpers.createRawParts(ctrls.html.value, ctrls.css.value, ctrls.js.value),
                    blobArray = _this.helpers.wrapProjectParts(),
                    projectName = _this.data.ctrls.project.value,
                    project = _this.helpers.createProject(projectName, rawParts, blobArray)
                   
                store.set(0, projectName, project);
                _this.functions.getProjects();
            }
        }
    }
    mcsandy.init();

</script>
    </body>
</html>
